<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEST Pension vs Index Fund Comparison</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.2em;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .key-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .result-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .result-card h3 {
            margin: 0 0 15px 0;
            font-size: 1.3em;
        }
        
        .amount {
            font-size: 2.2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .chart-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .assumptions {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 5px solid #27ae60;
        }
        
        .assumptions h3 {
            color: #27ae60;
            margin-top: 0;
        }
        
        .assumptions ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .assumptions li {
            margin: 8px 0;
            line-height: 1.5;
        }
        
        .controls {
            background: #f1f2f6;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .control-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .control-item {
            display: flex;
            flex-direction: column;
        }
        
        .control-item label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        .control-item input {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .control-item input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .comparison-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .comparison-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .comparison-table tr:nth-child(even) {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üí∞ NEST Pension vs Index Fund Investment</h1>
        <p class="subtitle">Flexible comparison with customizable age range and annual contribution increases</p>
        
        <div class="controls">
            <div class="control-group">
                <div class="control-item">
                    <label>Starting Age</label>
                    <input type="number" id="startAge" value="30" min="18" max="65">
                </div>
                <div class="control-item">
                    <label>Retirement Age</label>
                    <input type="number" id="endAge" value="66" min="50" max="75">
                </div>
                <div class="control-item">
                    <label>Monthly Contribution (¬£)</label>
                    <input type="number" id="monthlyAmount" value="100" min="1" max="10000">
                </div>
                <div class="control-item">
                    <label>Annual Increase (%)</label>
                    <input type="number" id="annualIncrease" value="3" min="0" max="15" step="0.5">
                </div>
            </div>
            <div class="control-group">
                <div class="control-item">
                    <label>NEST Annual Return (%)</label>
                    <input type="number" id="nestReturn" value="5.5" min="0" max="15" step="0.1">
                </div>
                <div class="control-item">
                    <label>Index Fund Annual Return (%)</label>
                    <input type="number" id="indexReturn" value="7.0" min="0" max="15" step="0.1">
                </div>
                <div class="control-item">
                    <label>Tax Relief Rate (%)</label>
                    <input type="number" id="taxRelief" value="20" min="0" max="45" step="1">
                </div>
                <div class="control-item">
                    <label>Employer Contribution (%)</label>
                    <input type="number" id="employerContrib" value="3" min="0" max="20" step="0.5">
                </div>
            </div>
            <div class="control-group">
                <div class="control-item">
                    <label>Withdrawal Rate (%/year)</label>
                    <input type="number" id="withdrawalRate" value="4" min="1" max="10" step="0.5">
                </div>
            </div>
        </div>
        
        <div class="key-results" id="keyResults">
            <!-- Results will be populated by JavaScript -->
        </div>
        
        <div class="chart-container">
            <canvas id="comparisonChart"></canvas>
        </div>
        
        <table class="comparison-table">
            <thead>
                <tr>
                    <th>Factor</th>
                    <th>NEST Pension</th>
                    <th>Direct Index Fund</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Tax Relief</strong></td>
                    <td>‚úÖ 20% basic rate (25% higher rate)</td>
                    <td>‚ùå None</td>
                </tr>
                <tr>
                    <td><strong>Access</strong></td>
                    <td>‚ùå Age 57+ only (25% tax-free)</td>
                    <td>‚úÖ Anytime</td>
                </tr>
                <tr>
                    <td><strong>Annual Charges</strong></td>
                    <td>0.3% + fund charges (~0.75% total)</td>
                    <td>~0.2% (low-cost index funds)</td>
                </tr>
                <tr>
                    <td><strong>Tax on Growth</strong></td>
                    <td>Tax-free growth</td>
                    <td>Capital gains tax (20% on gains above ¬£6,000/year during withdrawal)</td>
                </tr>
                <tr>
                    <td><strong>Employer Contributions</strong></td>
                    <td>‚úÖ Minimum 3% (included in calculation)</td>
                    <td>‚ùå None</td>
                </tr>
                <tr>
                    <td><strong>Investment Control</strong></td>
                    <td>Limited fund choices</td>
                    <td>Full control over investments</td>
                </tr>
            </tbody>
        </table>
        
        <div class="assumptions">
            <h3>üìä Key Assumptions Used</h3>
            <ul>
                <li><strong>NEST Pension:</strong> 5.5% annual return (post-fees), 20% tax relief, 0.75% total annual charges</li>
                <li><strong>Index Fund:</strong> 7% annual return (pre-tax), 0.2% annual charges, realistic withdrawal strategy using ¬£6,000 capital gains allowance each year</li>
                <li><strong>Withdrawal Strategy:</strong> 4% per year over 25 years of retirement, maximizing capital gains allowance annually</li>
                <li><strong>Employer Contributions:</strong> 3% of ¬£30,000 annual salary (¬£75/month) - only applies to pension</li>
                <li><strong>Contributions:</strong> Starting contribution with annual increases to simulate wage growth (default 3%)</li>
                <li><strong>Age Range:</strong> Customizable investment period (default 30-66)</li>
                <li><strong>Inflation:</strong> Not adjusted for inflation in these figures</li>
                <li><strong>Tax rates:</strong> Assumed to remain constant (unlikely in reality)</li>
            </ul>
        </div>
        
        <div class="warning">
            <strong>‚ö†Ô∏è Important Notes:</strong> This comparison includes employer pension contributions. Annual contribution increases simulate wage growth over career. Actual returns will vary, and past performance doesn't guarantee future results. Tax rules and rates may change. Consider seeking professional financial advice for your specific situation.
        </div>
    </div>

    <script>
        let chart;
        
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-GB', {
                style: 'currency',
                currency: 'GBP',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }
        
        function calculateCompoundGrowth(monthlyAmount, annualRate, years, taxRelief = 0, annualCharges = 0, employerContrib = 0, annualIncrease = 0) {
            const effectiveAnnualRate = annualRate - annualCharges;
            const effectiveMonthlyRate = effectiveAnnualRate / 12 / 100;
            const months = years * 12;
            
            // Assumed monthly salary for employer contribution calculation
            const assumedMonthlySalary = 2500; // ¬£30k/year
            
            let balance = 0;
            const yearlyBalances = [];
            let currentMonthlyAmount = monthlyAmount;
            let totalEmployeeContrib = 0;
            let totalEmployerContrib = 0;
            
            for (let month = 1; month <= months; month++) {
                // Apply tax relief to employee contribution
                const effectiveMonthlyAmount = currentMonthlyAmount * (1 + taxRelief / 100);
                
                // Calculate employer contribution
                const monthlyEmployerContrib = assumedMonthlySalary * (employerContrib / 100);
                
                // Total monthly contribution
                const totalMonthlyContrib = effectiveMonthlyAmount + monthlyEmployerContrib;
                
                // Apply compound growth
                balance = balance * (1 + effectiveMonthlyRate) + totalMonthlyContrib;
                
                // Track contributions
                totalEmployeeContrib += currentMonthlyAmount;
                totalEmployerContrib += monthlyEmployerContrib;
                
                // Increase contributions annually
                if (month % 12 === 0) {
                    yearlyBalances.push(balance);
                    currentMonthlyAmount = currentMonthlyAmount * (1 + annualIncrease / 100);
                }
            }
            
            return { 
                finalBalance: balance, 
                yearlyBalances, 
                totalEmployeeContrib,
                totalEmployerContrib,
                totalContrib: totalEmployeeContrib + totalEmployerContrib
            };
        }
        
        function calculateIndexGrowthWithTax(monthlyAmount, annualRate, years, annualCharges = 0.2, withdrawalRate = 4, annualIncrease = 0) {
            const monthlyRate = (annualRate - annualCharges) / 12 / 100;
            const months = years * 12;
            const capitalGainsAllowance = 6000;
            const capitalGainsRate = 0.20;
            
            let balance = 0;
            let totalContributions = 0;
            const yearlyBalances = [];
            let currentMonthlyAmount = monthlyAmount;
            
            // Calculate compound growth without tax interference
            for (let month = 1; month <= months; month++) {
                balance = balance * (1 + monthlyRate) + currentMonthlyAmount;
                totalContributions += currentMonthlyAmount;
                
                if (month % 12 === 0) {
                    yearlyBalances.push(balance);
                    // Increase contributions annually
                    currentMonthlyAmount = currentMonthlyAmount * (1 + annualIncrease / 100);
                }
            }
            
            // Model realistic withdrawal strategy over retirement
            // Assume 25 years of retirement, withdrawing gradually
            const retirementYears = 25;
            const annualWithdrawal = balance * (withdrawalRate / 100);
            let remainingBalance = balance;
            let remainingContributions = totalContributions;
            let totalCapitalGainsTax = 0;
            
            for (let year = 1; year <= retirementYears && remainingBalance > 0; year++) {
                // Portfolio grows during the year
                remainingBalance *= (1 + (annualRate - annualCharges) / 100);
                
                // Calculate how much to withdraw
                const withdrawAmount = Math.min(annualWithdrawal, remainingBalance);
                
                // Proportion of withdrawal that is gains vs contributions
                const gainsRatio = Math.max(0, (remainingBalance - remainingContributions) / remainingBalance);
                const gainsPortion = withdrawAmount * gainsRatio;
                const contributionsPortion = withdrawAmount * (1 - gainsRatio);
                
                // Apply capital gains tax (use allowance each year)
                const taxableGains = Math.max(0, gainsPortion - capitalGainsAllowance);
                const yearlyTax = taxableGains * capitalGainsRate;
                totalCapitalGainsTax += yearlyTax;
                
                // Update remaining balances
                remainingBalance -= withdrawAmount;
                remainingContributions -= contributionsPortion;
                
                // Stop if we've withdrawn everything
                if (remainingBalance < 1000) break;
            }
            
            // Calculate effective value after considering gradual withdrawal tax
            const effectiveValue = balance - totalCapitalGainsTax;
            
            return { 
                finalBalance: effectiveValue,
                grossBalance: balance,
                yearlyBalances, 
                totalContributions,
                capitalGainsTax: totalCapitalGainsTax,
                averageEffectiveTaxRate: (totalCapitalGainsTax / (balance - totalContributions)) * 100
            };
        }
        
        function updateCalculations() {
            const startAge = parseInt(document.getElementById('startAge').value);
            const endAge = parseInt(document.getElementById('endAge').value);
            const monthlyAmount = parseFloat(document.getElementById('monthlyAmount').value);
            const annualIncrease = parseFloat(document.getElementById('annualIncrease').value);
            const nestReturn = parseFloat(document.getElementById('nestReturn').value);
            const indexReturn = parseFloat(document.getElementById('indexReturn').value);
            const taxRelief = parseFloat(document.getElementById('taxRelief').value);
            const employerContrib = parseFloat(document.getElementById('employerContrib').value);
            const withdrawalRate = parseFloat(document.getElementById('withdrawalRate').value);
            
            const years = endAge - startAge;
            
            if (years <= 0) {
                document.getElementById('keyResults').innerHTML = '<div class="result-card"><h3>‚ö†Ô∏è Invalid Age Range</h3><p>Retirement age must be greater than starting age</p></div>';
                return;
            }
            
            // Calculate NEST pension (with employer contributions and annual increases)
            const nestResult = calculateCompoundGrowth(monthlyAmount, nestReturn, years, taxRelief, 0.75, employerContrib, annualIncrease);
            
            // Calculate index fund with realistic withdrawal tax strategy and annual increases
            const indexResult = calculateIndexGrowthWithTax(monthlyAmount, indexReturn, years, 0.2, withdrawalRate, annualIncrease);
            
            // Update key results
            const nestAdvantage = nestResult.finalBalance - indexResult.finalBalance;
            const employerContribTotal = nestResult.totalEmployerContrib || 0;
            
            document.getElementById('keyResults').innerHTML = `
                <div class="result-card">
                    <h3>üíº NEST Pension</h3>
                    <div class="amount">${formatCurrency(nestResult.finalBalance)}</div>
                    <p>Including ${formatCurrency(employerContribTotal)} employer contributions</p>
                </div>
                <div class="result-card">
                    <h3>üìà Index Fund</h3>
                    <div class="amount">${formatCurrency(indexResult.finalBalance)}</div>
                    <p>After ${formatCurrency(indexResult.capitalGainsTax || 0)} tax over ${withdrawalRate}%/year withdrawals</p>
                </div>
                <div class="result-card">
                    <h3>üìä Difference</h3>
                    <div class="amount" style="color: ${nestAdvantage >= 0 ? '#27ae60' : '#e74c3c'}">
                        ${nestAdvantage >= 0 ? '+' : ''}${formatCurrency(nestAdvantage)}
                    </div>
                    <p>${nestAdvantage >= 0 ? 'Pension advantage' : 'Index fund advantage'}</p>
                </div>
                <div class="result-card">
                    <h3>üí∞ Your Contributions</h3>
                    <div class="amount">${formatCurrency(nestResult.totalEmployeeContrib || indexResult.totalContributions)}</div>
                    <p>Over ${years} years (age ${startAge}-${endAge})</p>
                </div>
            `;
            
            // Update chart
            updateChart(nestResult.yearlyBalances, indexResult.yearlyBalances, startAge, years);
        }
        
        function updateChart(nestData, indexData, startAge, years) {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            
            const ages = Array.from({length: years}, (_, i) => startAge + i + 1);
            
            if (chart) {
                chart.destroy();
            }
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ages,
                    datasets: [{
                        label: 'NEST Pension',
                        data: nestData,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.1,
                        pointRadius: 2,
                        pointHoverRadius: 6
                    }, {
                        label: 'Index Fund (after tax)',
                        data: indexData,
                        borderColor: '#764ba2',
                        backgroundColor: 'rgba(118, 75, 162, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.1,
                        pointRadius: 2,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Investment Growth Over Time',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + formatCurrency(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Age',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Investment Value (¬£)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    }
                }
            });
        }
        
        // Add event listeners for real-time updates
        document.getElementById('startAge').addEventListener('input', updateCalculations);
        document.getElementById('endAge').addEventListener('input', updateCalculations);
        document.getElementById('monthlyAmount').addEventListener('input', updateCalculations);
        document.getElementById('annualIncrease').addEventListener('input', updateCalculations);
        document.getElementById('nestReturn').addEventListener('input', updateCalculations);
        document.getElementById('indexReturn').addEventListener('input', updateCalculations);
        document.getElementById('taxRelief').addEventListener('input', updateCalculations);
        document.getElementById('employerContrib').addEventListener('input', updateCalculations);
        document.getElementById('withdrawalRate').addEventListener('input', updateCalculations);
        
        // Initial calculation
        updateCalculations();
    </script>
</body>
</html>